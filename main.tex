\newif\iffull
\newif\ifnotes
\newif\iflabels
\newif\ifanonymous
\newif\ifspace
\newif\ifcameraready
\newif\ifbibtex
\newif\ifsolutions

%%% Settings
%% Full version of the paper
\fulltrue
%% Show notes and todos
\notestrue
%% Print labels in the margins
% \labelstrue
%% Hide authors
\anonymoustrue
%% Enable hacks to save space
% \spacetrue
%% Disable some tweaks that the publisher may not like
% \camerareadytrue
%% Use legacy BibTeX instead of Biber
% \bibtextrue
%% Include solutions in the output
\solutionstrue

\documentclass[
  %% Uncomment to enable letterpaper
  a4paper,
  orivec,oribibl]{llncs}
\unless\ifcameraready
    \usepackage{llncsstandalone}  % local package
    % This is equivalent to 3cm margins (and the page shifted 0.5cm up)
    % on a4paper but gives an identical textblock on letterpaper.
    \usepackage[twoside=false, textwidth=150mm, textheight=237mm, vmarginratio=5:7, footskip=13mm]{geometry}
\fi
\usepackage[save]{silence}
\usepackage[T1]{fontenc}
\usepackage{lmodern}

%%% Space savings.
%%% The evil stuff. Uncomment manually.
\ifspace
  %% Scale line spacing. This becomes apparent at ~0.985 and below.
  % \renewcommand\baselinestretch{0.99}
  %% Always use inline style for \sum, \prod, ...
  % \PassOptionsToPackage{nosumlimits}{amsmath}
\fi

%%% Misc early packages
\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage[babel,final]{microtype}
\usepackage{xpunctuate}
\usepackage{dirtytalk}
\usepackage{pifont}  % Dingbats
\usepackage{tcolorbox}
\tcbset{colback=white, size=title, boxsep=2mm}

%%% Colors
\usepackage[dvipsnames,svgnames,x11names]{xcolor}
\definecolor{bitcoin-orange}{RGB}{246, 145, 29}

%%% Math
\usepackage{amsmath}  % mostly for \qedhere
\usepackage{fixcmex}
% amsthm's proof environment conflicts with that of llncs
\let\lncsproof\proof
\let\lncsendproof\endproof
\let\proof\relax
\let\endproof\relax
\usepackage{amsthm}
\usepackage{mathtools}  % for \coloneq

%%% Notes and Todos
\NewDocumentCommand\newuser{m m m}{%
  \expandafter\NewDocumentCommand\csname #1note\endcsname{s O{} +m}{
    % Ensure that todos after paragraph headings are properly displayed
    \quitvmode%
    \texorpdfstring{%
      \todo[color=#3, inline, caption={}, ##2]{\textbf{#2:} ##3}%
    }{(Note by #2: ##3)}%
  }}
\ifnotes
  \usepackage{todonotes}
\else
  \usepackage[disable]{todonotes}
\fi

\iflabels
  \usepackage[notref,notcite,color]{showkeys}
\fi

%%% Bibliography
\ifbibtex
  \PassOptionsToPackage{backend=bibtex}{biblatex}
\fi
\PassOptionsToPackage{
  date=year,
  maxnames=3,
  minnames=3,
}{biblatex}
\ifcameraready
  \usepackage[
  style=biblatex-lncs/lncs,
  ]{biblatex}
  % Disable shorthands, see https://github.com/plk/biblatex/issues/1427
  \DeclareFieldInputHandler{shorthand}{\def\NewValue{}}
\else
  \usepackage[
  style=alphabetic,
  maxbibnames=15,
  minbibnames=15,
  ]{biblatex}
\fi

%%% Printing ePrint identifiers
\newcommand\iacreprintname{Cryptology ePrint Archive}
%% Shorter alternative:
% \newcommand\iacreprintname{IACR ePrint}
% TODO Consider just "\textsc{IACR}" (like for URL and DOI).
\DeclareFieldFormat{eprint:iacr}{%
  \iacreprintname\addcolon\space
  \ifhyperref
    {\href{https://eprint.iacr.org/#1}{%
       \nolinkurl{#1}%
       \iffieldundef{eprintclass}
         {}
         {\addspace\texttt{\mkbibbrackets{\thefield{eprintclass}}}}}}
    {\nolinkurl{#1}%
     \iffieldundef{eprintclass}
       {}
       {\addspace\texttt{\mkbibbrackets{\thefield{eprintclass}}}}}}

\addbibresource{vendor/cryptobib/abbrev3.bib}
% "crypto.bib" will be treated specially: We use the biber-wrapper.sh
% script to extract the cited entries from crypto.bib into a temporary
% bib file and then call biber on it, to avoid that biber takes very
% long to process the huge crypto.bib. All of this should happen
% automatically and transparently if you use latexmk.
\addbibresource{vendor/cryptobib/crypto.bib}
\addbibresource{add.bib}

%%% Save space in references
\AtEveryBibitem{
  % See Section 2.2.2 in the BibLaTeX manual for the field types
  \unless\iffull
    \clearfield{doi}
  \fi
  \clearlist{location}
  \clearname{editor}
  \clearfield{pages}
  \ifentrytype{inproceedings}{
      \clearfield{year}
      \clearfield{volume}
      \clearlist{publisher}
      \clearfield{series}
    }{}
}

%%% hyperref
\unless\ifcameraready
  \PassOptionsToPackage{pdfusetitle}{hyperref}
\fi
\usepackage{hyperref}
\hypersetup{
  hypertexnames=false,
}
\unless\ifcameraready
  \hypersetup{
    colorlinks=true,
    allcolors=blue,
    bookmarksopen,
  }
\usepackage{bookmark}
\fi

%%% Cross-references
\usepackage[capitalize, nameinlink]{cleveref}
% Force "eq.", "line" and "item" to be lowercase.
% "eq.~" is a bit involved: We'll \crefformat to include the "~",
% but we don't want to abbreviate at the beginning of a sentence.
% All these definitions are based on "equation" examples in the
% cleveref manual.
\crefformat{equation}{#2eq.~(#1)#3}
\Crefformat{equation}{#2Equation~(#1)#3}
\crefmultiformat{equation}{eqs.~(#2#1#3)}{ and~(#2#1#3)}{, (#2#1#3)}{ and~(#2#1#3)}
\Crefmultiformat{Equation}{Equations~(#2#1#3)}{ and~(#2#1#3)}{, (#2#1#3)}{ and~(#2#1#3)}
\crefrangeformat{Equation}{eqs.~(#3#1#4) to~(#5#2#6)}
\crefrangeformat{Equation}{Equations~(#3#1#4) to~(#5#2#6)}
\Crefname{equation}{Equation}{Equations}  % Don't abbreviate at start of sentence
\crefname{line}{line}{lines}
\Crefname{line}{Line}{Lines}
\crefname{enumi}{item}{items}
\Crefname{enumi}{Item}{Items}

%%% Alternative for cross-references
% \usepackage{zref-clever}
% \zcsetup{cap}
% % Replacement for \namecref
% \newcommand{\zcnameref}[1]{\zcref*[noref,nocap]{#1}}
% \zcRefTypeSetup{assumption}{
%   Name-sg = Assumption ,
%   name-sg = assumption ,
%   Name-pl = Assumptions ,
%   name-pl = assumptions ,
% }
% \zcRefTypeSetup{equation}{
%   abbrev = true ,
% }

%%% Additional theorem-like environments
\newtheorem{assumption}{Assumption}
\Crefname{assumption}{Assumption}{Assumptions}

%%% Exercise environment with section-based numbering
% Reset exercise counter at each section
\makeatletter
\@addtoreset{exercise}{section}
\makeatother
% Redefine the exercise environment to use section numbering
\renewcommand{\theexercise}{\thesection.\arabic{exercise}}
% Configure cleveref for exercises
\Crefname{exercise}{Exercise}{Exercises}
\crefname{exercise}{exercise}{exercises}

%%% Section-based numbering for theorem-like environments
\makeatletter
% Reset all theorem-like counters at each section
\@addtoreset{theorem}{section}
\@addtoreset{lemma}{section}
\@addtoreset{proposition}{section}
\@addtoreset{corollary}{section}
\@addtoreset{definition}{section}
\@addtoreset{remark}{section}
\@addtoreset{assumption}{section}
% Redefine numbering to use section.number format
\renewcommand{\thetheorem}{\thesection.\arabic{theorem}}
\renewcommand{\thelemma}{\thesection.\arabic{lemma}}
\renewcommand{\theproposition}{\thesection.\arabic{proposition}}
\renewcommand{\thecorollary}{\thesection.\arabic{corollary}}
\renewcommand{\thedefinition}{\thesection.\arabic{definition}}
\renewcommand{\theremark}{\thesection.\arabic{remark}}
\renewcommand{\theassumption}{\thesection.\arabic{assumption}}
\makeatother

%%% Configure cleveref for theorem-like environments
\Crefname{theorem}{Theorem}{Theorems}
\crefname{theorem}{theorem}{theorems}
\Crefname{lemma}{Lemma}{Lemmas}
\crefname{lemma}{lemma}{lemmas}
\Crefname{proposition}{Proposition}{Propositions}
\crefname{proposition}{proposition}{propositions}
\Crefname{corollary}{Corollary}{Corollaries}
\crefname{corollary}{corollary}{corollaries}
\Crefname{definition}{Definition}{Definitions}
\crefname{definition}{definition}{definitions}
\Crefname{remark}{Remark}{Remarks}
\crefname{remark}{remark}{remarks}

%%% Section-based numbering for figures and tables
\makeatletter
% Reset figure and table counters at each section
\@addtoreset{figure}{section}
\@addtoreset{table}{section}
% Redefine numbering to use section.number format
\renewcommand{\thefigure}{\thesection.\arabic{figure}}
\renewcommand{\thetable}{\thesection.\arabic{table}}
\makeatother

%%% Configure cleveref for figures and tables (usually already configured by cleveref)
\Crefname{figure}{Figure}{Figures}
\crefname{figure}{figure}{figures}
\Crefname{table}{Table}{Tables}
\crefname{table}{table}{tables}

%%% Solution handling
\newenvironment{mysolution}{\begin{proof}[Solution]}{\end{proof}}

%%% Cryptocode
\WarningFilter*[theH]{latex}{Command `\string\the}%
\ActivateWarningFilters[theH]
\usepackage[
  lambda,
  advantage,
  operators,
  adversary,
  landau,
  probability,
  sets,
  % notions,
  % logic,
  % ff,
  % mm,
  % primitives,
  % oracles,
  events,
  % complexity,
  asymptotics,
  keys,
]{cryptocode}
\DeactivateWarningFilters[theH]

% Better version of \pcfixcleveref:
% (see https://github.com/arnomi/cryptocode/pull/15)
\IfPackageLoadedTF{cleveref}{
  \AtBeginDocument{
    \pcfixhyperref%
    \makeatletter
    \crefalias{@pclinenumber}{line}%
    \makeatother
    % TODO Consider further improvements for the interaction between
    % crytocode and cleveref, e.g., referencing games, see: https://tex.stackexchange.com/questions/623163/cryptocode-cref-should-link-to-a-game-and-write-its-name/623196#623196
  }
}{}

%%% Append "." to subsubsection and paragraph headings
\let\llncssubsubsection\subsubsection
\renewcommand{\subsubsection}[1]{\llncssubsubsection{#1.}}
\let\llncsparagraph\paragraph
\renewcommand{\paragraph}[1]{\llncsparagraph{#1.}}


\input{tex/macros.tex}


%%% Title
%
% Springer wants:
% All words in titles should be capitalized except for conjunctions, prepositions
% (e.g. on, of, by, and, or, but, from, with, without, under), and definite/indefinite
% articles (the, a, an), unless they appear at the beginning. Formula letters are
% typeset as in the text.
%
% Hint: https://titlecaseconverter.com/
\title{\texorpdfstring{%
    Provable Cryptography for Bitcoin: An Introduction%
  }{% Title for PDF metadata and bookmarks:
    Provable Cryptography for Bitcoin: An Introduction%
  }
}

%%% Authors
\RenewDocumentCommand\email{m}{\href{mailto:#1}{\texttt{\textcolor{black}{#1}}}}
\author{Jonas Nick}\institute{Blockstream Research\\
\email{jonas@n-ck.net}}

%%% Notes and Todos
% Usage: \newuser{a}{Alice}{orange!20}
%
% The "!20" suffix creates a mix of 20% of the preceding color and 80%
% white. See https://latexcolor.com/ for predefined colors.
\newuser{a}{Alice}{orange!20}
\newuser{b}{Bob}{olive!20}

\begin{document}

\maketitle

\begin{center}
  \textbf{License:} This work is released into the public domain under CC0 1.0\\
  \url{https://creativecommons.org/publicdomain/zero/1.0/}
\end{center}

\iffull
  \begin{center}
    \today
  \end{center}
\fi

%%% Keywords
\ifcameraready
  \keywords{a keyword \and another one \and keywords are separated with \texttt{\textbackslash{}and}}
\fi

%%% Table of Contents
\iffull
  \tableofcontents
  \clearpage
\fi

%%% Uncomment this for usage notes on this LaTeX template
% \input{README-TEMPLATE.tex}

\input{tex/intro.tex}
\input{tex/reductions.tex}
\input{tex/commitments.tex}
\input{tex/accumulators.tex}
\input{tex/one-time-sigs.tex}
\input{tex/discrete-log.tex}
\input{tex/rom.tex}
\input{tex/fl.tex}
\input{tex/signatures.tex}
\input{tex/signatures-key-tweaking.tex}
\input{tex/ias.tex}


%%% Appendix
\appendix
\crefalias{section}{appendix}

\section{Appendix: Proofs of Negligible Function Properties}\label{sec:appendix-negl-proofs}

This appendix contains the proofs of properties (2)-(4) from Lemma~\ref{lem:negl}.

\begin{proof}[Proof of Lemma~\ref{lem:negl}(2)]
  Let $f_1, f_2$ be negligible functions.
  We need to show that $f_1 + f_2$ is negligible.
  
  Let $c > 0$ be arbitrary. We must find $N$ such that $(f_1 + f_2)(\secpar) < \secpar^{-c}$ for all $\secpar > N$.
  
  Since $f_1$ and $f_2$ are negligible, for the constant $c + 1 > 0$, there exist $N_1, N_2 \in \NN$ such that:
  \[
  \forall \secpar > N_1: f_1(\secpar) < \secpar^{-(c+1)} \quad \text{and} \quad \forall \secpar > N_2: f_2(\secpar) < \secpar^{-(c+1)}
  \]
  
  Let $N = \max(N_1, N_2, 2)$. Then for all $\secpar > N$:
  \[
    f_1(\secpar) + f_2(\secpar) < \secpar^{-(c+1)} + \secpar^{-(c+1)} = 2 \cdot \secpar^{-(c+1)} = \frac{2}{\secpar} \cdot \secpar^{-c} \leq \secpar^{-c}
  \]
  where the last inequality holds because $\frac{2}{\secpar} \leq 1$ when $\secpar \geq 2$, which is guaranteed by our choice of $N$.
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lem:negl}(3)]
  Let $f$ be a negligible function with $f(\secpar) \ge 0$ and let $k > 0$ be a constant.
  We need to show that $f + k$ is not negligible.
  
  Assume for contradiction that $f + k$ is negligible. 
  Then for the constant $c = 1$, there exists $N \in \NN$ such that for all $\secpar > N$:
  \[
    f(\secpar) + k < \secpar^{-1}
  \]
  
  Since $f(\secpar) \ge 0$, we have $f(\secpar) + k \ge k$ for all $\secpar$.
  
  Choose $\secpar_0 = \max(N + 1, \lceil \frac{2}{k} \rceil)$. Then $\secpar_0 > N$ and $\secpar_0^{-1} \le \frac{k}{2}$.
  
  By our assumption, we must have:
  \[
    k \le f(\secpar_0) + k < \secpar_0^{-1} \le \frac{k}{2}
  \]
  
  This gives us $k < \frac{k}{2}$, which is a contradiction.
  
  Therefore, $f + k$ is not negligible.
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lem:negl}(4)]
  Let $f$ be a non-negligible function and $g$ be a negligible function.
  Assume for contradiction that $f - g$ is negligible.
  Then by property (2), $(f - g) + g = f$ would be negligible (as the sum of two negligible functions).
  This contradicts the assumption that $f$ is non-negligible.
\end{proof}

\section{Appendix: Notation}\label{sec:appendix-notation}

%%% Acknowledgements
\section*{Acknowledgements}
We thank Nadav Kohen for valuable feedback and discussions.
We also thank Claude for assistance with revisions and exercises.

%%% Changelog
\iffull
  \phantomsection
  \addcontentsline{toc}{section}{Changelog}

  \section*{Changelog}\label{sec:changelog}
  \begin{description}
    \item[2025-08-25]\
          \begin{itemize}
            \item First draft.
          \end{itemize}
  \end{description}
  % TODO Why is spacing wrong without this?
  \vspace{-2em}
\fi

%%% Bibliography
\phantomsection
\addcontentsline{toc}{section}{References}
\printbibliography\label{sec:bib}

\end{document}
