\section{Commitments}\label{sec:commitments}

% TODO: mention that the params are often given implicitly

\subsection{Syntax}
\begin{definition}[Commitment Scheme]
  A \emph{commitment scheme} $\algo{Com}$is a pair of p.p.t algorithms $(\algo{Setup}, \algo{Commit})$ where
  \begin{itemize}
    \item $\algo{Setup}(1^\lambda) \rightarrow \params$ is a probabilistic algorithm that takes the security parameter $\lambda$ and returns public parameters $\params$, which include the message space $\mathcal{M}$ and the randomness space $\mathcal{R}$.
    \item $\algo{Commit}(\params, m; r) \rightarrow C$ is a deterministic algorithm that takes the public parameters $\params$, a message $m \in \mathcal{M}$ and randomness $r \in \mathcal{R}$ and returns a commitment $C$.
  \end{itemize}
\end{definition}

\begin{example}
  An example is the trivial commitment scheme\label{sec:trivial-com}:
  \begin{itemize}
    \item $\algo{Setup}(1^\lambda) \defeq (\mathcal{M} \defeq \{0, 1\}^*, \mathcal{R} \defeq \{\})$
    \item $\algo{Commit}(\params,m;r) \defeq m$
  \end{itemize}
\end{example}

\subsection{Security}

\begin{figure}[tbhp]
  \begin{center}
    \begin{tcolorbox}[width=8cm]
      \begin{pchstack}[center]
        \procedure[headlinesep=1pt]{$\game{\Game~\algo{ComBind}}{\algo{Com}}$}{%
            \params \sample \algo{Com.Setup}(1^\lambda) \\
            (m_0, m_1, r_0, r_1) \gets \adv(\params) \\
            C_0 \gets \algo{Com.Commit}(\params, m_0; r_0) \\
            C_1 \gets \algo{Com.Commit}(\params, m_1; r_1) \\
            \pcreturn (C_0 = C_1) \wedge (m_0 \neq m_1)
        }
      \end{pchstack}
    \end{tcolorbox}
  \end{center}
  \caption{Binding game \label{fig:break-com-bind}}
\end{figure}

\begin{definition}[Binding]
  A commitment scheme $\algo{Com}$ is binding if for any p.p.t. algorithm $\adv$,
 \[
  \advantage{Bind}{\adv, \algo{Com}} \defeq \pr{\game{\algo{ComBind}}{\algo{Com}} = \pctrue} = \negl.
 \]
 If $\advantage{Bind}{\adv, \algo{Com}} = 0$, then the commitment scheme is said to be \emph{perfectly binding}.
\end{definition}

Note that in $\game{\algo{ComBind}}{\algo{Com}}$ the adversary $\adv$ is run twice with different arguments, first to output two messages and then to output a bit.

\begin{figure}[tbhp]
  \begin{center}
    \begin{tcolorbox}[width=8cm]
      \begin{pchstack}[center]
        \procedure[headlinesep=1pt]{$\game{\Game~\algo{ComHid}}{\algo{Com}}$}{%
            \params \sample \algo{Com}.\algo{Setup}(1^\lambda) \\
            (m_0, m_1) \gets \adv(\params) \\
            r \sample \params.\mathcal{R} \\
            b \sample \{0, 1\} \\
            C \gets \algo{Com}.\algo{Commit}(\params, m_b; r) \\
            b' \gets \adv(\params, C) \\
            \pcreturn (b = b')
        }
      \end{pchstack}
    \end{tcolorbox}
  \end{center}
  \caption{Hiding game \label{fig:break-com-hid}}
\end{figure}

\begin{definition}[Hiding]
  A commitment scheme $\algo{Com}$ is hiding if for any p.p.t. algorithm $\adv$,
 \[
  \advantage{Hid}{\adv, \algo{Com}} \defeq |\pr{\game{\algo{ComHid}}{\algo{Com}} = \pctrue} - \frac{1}{2}| = \negl.
 \]
 If $\advantage{Bind}{\adv, \algo{Com}} = 0$, then the commitment scheme is said to be \emph{perfectly binding}.
\end{definition}

\subsection{Exercises}
\begin{itemize}
  \item Is the trivial commitment scheme in \cref{sec:trivial-com} binding?.
  \item Informally, a commitment scheme is \emph{strong binding} if commitment cannot be opened to randomness $r$ and $r'$ such that $r \neq r'$. 
        Define $\game{\algo{ComStrongBind}}{\algo{Com}}$ by changing the definition of $\game{\algo{ComBind}}{\algo{Com}}$.
  \item Can you imagine situations where strong binding is useful? (Think Taproot randomness is a group element and assume OP\_INTERNALKEY (we haven't introduced taproot at all yet, so this is confusing))
  \item Come up with a hash commitment scheme that is strongly binding (or just binding if you didn't manage the previous session). Argue for your solution. Write down the theorem.
  \item Is the trivial commitment scheme in \cref{sec:trivial-com} hiding?
        Prove it.
        (Hint: if it is not hiding, give an adversary that wins the $\game{\algo{ComHid}}{\algo{Com}}$ with non-negligible probability.)
  \item Let $\algo{H}$ be a collision-resistant hash function and let $\algo{HashCom'}$ be a commitment scheme where
    \begin{itemize}
      \item $\algo{Setup}(1^\lambda) \defeq (\mathcal{M} \defeq \{0, 1\}, \mathcal{R} \defeq \{\}, \kappa \gets \algo{H.Gen}(1^\lambda))$.
      \item $\algo{Commit}(\params,m;r) \defeq  \algo{H.Eval}(\kappa, m)$.
    \end{itemize}
    Argue that it is binding and write down the security theorem.
    Prove that it's not hiding.
  \item Argue why a collision resistant hash function cannot be enough for hiding (even when the randomness is included in the hash).
\end{itemize}